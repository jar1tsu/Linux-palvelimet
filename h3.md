## x Lue ja tiivistä
The Apache Software Foundation 2023: Apache HTTP Server Version 2.4 Documentation:

### IP‑pohjainen virtualisointi
- Valinta tehdään IP‑osoitteen ja portin perusteella
- Jokainen sivusto tarvitsee oman IP‑osoitteen
- Käyttö nykyään harvinaista, ellei jokin laitteisto tai sovellus sitä nimenomaan vaadi

### Nimi‑pohjainen virtualisointi (Name‑based)
- Useita verkkotunnuksia voidaan palvella yhdellä IP‑osoitteella
- Valinta tehdään HTTP‑pyynnön Host‑headerin perusteella
- Helppo ottaa käyttöön: riittää, että DNS osoittaa kaikki domainit samaan IP:hen
- Säästää IP‑osoitteita ja on nykyisin suositeltu tapa melkein kaikissa ympäristöissä

### Miten Apache valitsee oikean VirtualHostin
1.IP + portti arvioidaan ensin
– Apache etsii ensin ne VirtualHost‑kohdat, jotka vastaavat pyynnön IP‑osoitetta ja porttia
– Jos käytetään *:80, kaikki kyseisen portin VHostit ovat samassa ryhmässä

2.ServerName ja ServerAlias ratkaisevat lopullisen valinnan
– Apache vertaa pyynnön Host‑arvoa ServerName/ServerAlias‑kenttiin
– Ensimmäinen täsmäävä VHost valitaan

3.Oletus‑VHost
– Jos nimi ei täsmää mihinkään, ensimmäinen kyseisen IP+portin VHostista toimii oletuksena.
– Siksi on hyvä määrittää tarkoituksellinen oletus‑VHost.

### ServerName ja ServerAlias
- Suositeltavaa määrittää ServerName aina, muuten Apache arvaa nimen, joka voi johtaa yllättäviin tuloksiin
- ServerAliasilla lisätään vaihtoehtoisia nimiä, esim.:
ServerAlias example.com *.example.com
- DNS:n tulee osoittaa kaikki aliakset samaan IP‑osoitteeseen, jotta ne toimivat

### VirtualHost‑lohkojen käyttö

- Jokaiselle sivustolle yksi <VirtualHost>‑lohko.

#### Vähintään tarvitaan:
  - ServerName = sivuston ensisijainen nimi
  - DocumentRoot = sivuston sisältökansio

- Muut asetukset voidaan lisätä lohkon sisään ja ne koskevat vain kyseistä sivustoa
- Pääkonfiguraation asetukset toimivat vain, ellei VHost yliaja niitä

Lähde: Apache. 2023. Name-based Virtual Host Support. Luettavissa: https://httpd.apache.org/docs/2.4/vhosts/name-based.html. Luettu: 1.2.2026.

Name Based Virtual Hosts on Apache - Multiple Websites to Single IP Address

- Apache mahdollistaa useiden sivustojen ajamisen yhdellä IP‑osoitteella käyttäen name‑based virtual hosteja
- Jokaiselle sivustolle tehdään oma konfiguraatiotiedosto hakemistoon
/etc/apache2/sites-available/<domain>.conf

#### Perusasetukset VirtualHostissa:
- ServerName = domain
- ServerAlias = vaihtoehtoinen nimi (esim. www)
- DocumentRoot = sivuston kansio
- Require all granted sallii sivuston näyttämisen


- Sivusto otetaan käyttöön komennolla a2ensite ja Apache restartataan
- Sivuston sisältö voidaan luoda tavallisella käyttäjällä omassa hakemistossa
- Ilman oikeaa DNS:ää testaus voidaan tehdä curlilla tai lisäämällä nimi hosts‑tiedostoon
- Jos eri domainit näyttävät eri sivut, name‑based virtual hosting toimii

Lähde : Karvinen, T. 2018. Name Based Virtual Hosts on Apache - Multiple Websites to Single IP Address. Luettavissa: https://terokarvinen.com/2018/04/10/name-based-virtual-hosts-on-apache-multiple-websites-to-single-ip-address/. Luettu: 1.2.2026.

### a) Testaa weppipalvelin
Apache-palvelin oli jo ladattu ja testasin sen komennolla curl http://localhost. Palvelin vastaa oikein, joten localhost toimii.

<img width="490" height="76" alt="image" src="https://github.com/user-attachments/assets/03596f84-f740-4239-b01b-f616c1a6f1a9" />

### b) Etsi lokista rivit, jotka syntyvät, kun lataat omalta palvelimeltasi yhden sivun
Teron "cheat-sheetista" löysin komennon `sudo tail -l /var/log/apache2/error.log`. Kuitenkin haluan access lokit esille, eli kokeilin samaa, mutta muutin lopun /access.log. 

<img width="852" height="50" alt="image" src="https://github.com/user-attachments/assets/8a4fd951-f96d-47ab-899b-d91428a69a24" />

Menin selaimeen ja sit kokeilin hakea sivua. Menin sit terminaaliin ja huomasin, että sinne ei ollut tullut mitään.

<img width="1500" height="714" alt="image" src="https://github.com/user-attachments/assets/17e22e0f-20de-4a9a-b7da-4ab662a7fcbb" />

Tutkin hieman asiaa ja tarkistin, että apache on päällä `sudo systemctl status apache2` sekä kuuntelee porttia 80 `sudo ss -tulpn | grep :80`. Netistä kuitenkin löyti tieto, että pyyntö kirjautuisi eri tiedostoon /other_vhosts_access.log. kokeilin sitä ja:

<img width="1582" height="848" alt="image" src="https://github.com/user-attachments/assets/5a465f97-6153-471a-b8e0-7586e26efe50" />
onnistuminen.
### Analyysi: 
- jari.example.com:80 = kertoo VirtualHostin nimen ja mitä porttia käytettiin
- 127.0.0.1 = IP-osoite. tässä tapauksessa localhost
- "- -" = identd-tunnus ja HTTP-autentikaaton käyttäjänimi. Ovat yleensä tyhjiä ellei ole erikseen identdiä tai Basic Authia
- [01/Feb/2026:22:44:04 +0200] = Aikaleima, kertoo milloin pyyntö tuli
- "GET / HTTP/1.1" = HTTP-pyyntö kokonaisuudessaan. GET on HTTP-metodi ja HTTP/1.1 on protokollaversio
- 304 = HTTP-statuskoodi, tässä tapauksessa 304 Not Modified
- 248 = Vastauksen koknaistavuja
- "-" = Referef-kenttä
- "Mozilla/5.0 (x11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0" = Mikä selain/ohjelma teki pyynnön, tässä tapauksessa Firefox Linuxilla

Lähde : Stackoverflow. s.a. Luettavissa: https://stackoverflow.com/questions/9234699/understanding-apaches-access-log. Luettu: 1.2.2026.

### c) Etusivu uusiksi
Tehtävän tarkoituksena on tehdä uusi name based virtual host. Sivun tulee näkyä suoraan palvelimen etusivulla http://localhost/. Sivua pitää pystyä muokkaamaan normaalina käyttäjänä.Tee uusi, laita vanhat pois päältä. Uusi sivu on hattu.example.com, ja tämän pitää näkyä: asetustiedoston nimessä, asetustiedoston ServerName-muuttujassa sekä etusivun sisällössä.

Lähdin tekemään samalla kuin kuvassa:
<img width="1696" height="1302" alt="image" src="https://github.com/user-attachments/assets/3b72301a-2038-4cba-8912-5ce0317c1000" />

eli ensimmäisenä luon uuden hakemiston hattu:
<img width="950" height="304" alt="image" src="https://github.com/user-attachments/assets/f2f92614-71d6-4919-a87d-4ad0148c70cc" />
Sitten annoin oikeudet chmod g+x /home/jari/
<img width="858" height="36" alt="image" src="https://github.com/user-attachments/assets/753f5c47-fc5e-4a0f-8978-cae8ec85ebf7" />
Sitten loin index.html tiedoston hattu kansioon komennolla `nano /home/jari/publicsites/hattu/index.html`.
Sen jälkeen loin uuden virtualhost tiedoston nano /etc/apache2/sites-available/hattu.example.com.conf`ja konffasin sen:
<img width="1130" height="726" alt="image" src="https://github.com/user-attachments/assets/0f37faf8-845f-4f20-bcaf-dada3eb1aaf1" />
Poistin vanhan sivun käytöstä, joka on tässä tapauksessa tunnilta tehty sivu komennolla: `sudo a2dissite jari.conf`. Vaihdoin sen uuteen `sudo a2ensite hattu.example.com.conf`. Sitten latasin apache2 `sudo systemctl reload apache2` ja tarkistin, että conf toimii `sudo apachectl configtest`.














